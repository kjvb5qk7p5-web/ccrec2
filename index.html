<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Card Advisor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      max-width: 900px;
    }
    h1, h2, h3 {
      margin-bottom: 0.3rem;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 16px;
    }
    label {
      display: block;
      margin-top: 8px;
      font-size: 0.9rem;
    }
    input, select, button, textarea {
      margin-top: 4px;
      padding: 6px 8px;
      font-size: 0.9rem;
    }
    input[type="number"] {
      width: 120px;
    }
    input[type="date"] {
      width: 150px;
    }
    select {
      min-width: 220px;
    }
    button {
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #f4f4f4;
    }
    button.primary {
      background: #0b6efd;
      color: white;
      border-color: #0b6efd;
    }
    #recommendationBox {
      font-weight: 500;
    }
    #reasonBox {
      font-size: 0.9rem;
      color: #444;
      margin-top: 4px;
    }
    /* TABLE STYLING – updated for iPhone width */
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.85rem;
      table-layout: fixed; /* ensure fixed layout so widths are respected */
    }
    th, td {
      border: 1px solid #ddd;
      padding: 4px 6px;
      text-align: left;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    th {
      background: #f7f7f7;
    }

    /* Column widths so it fits nicely on mobile
       1: Date, 2: Amount, 3: Category, 4: Channel, 5: Card Used
       Total = 100% */
    th:nth-child(1), td:nth-child(1) { width: 18%; } /* Date */
    th:nth-child(2), td:nth-child(2) { width: 14%; } /* Amount */
    th:nth-child(3), td:nth-child(3) { width: 24%; } /* Category */
    th:nth-child(4), td:nth-child(4) { width: 24%; } /* Channel */
    th:nth-child(5), td:nth-child(5) { width: 20%; } /* Card Used */

    #loggedTable {
    border-collapse: collapse;
    width: 100%;
    font-size: 0.5rem; /* adjust as small as you like */
    }

    #loggedTable th,
    #loggedTable td {
      padding: 2px 4px; /* optional: tighter padding to save space */
    }

    .muted {
      color: #777;
      font-size: 0.8rem;
    }
    .credit-met {
  color: green;
  font-weight: 600;
    }
    .inline {
      display: inline-block;
      margin-right: 12px;
    }
  </style>
</head>
<body>
  <h1>Which Card Should I Use?</h1>
  <p class="muted">
    Local brain for 4 cards: <br>
        &nbsp;&nbsp;&nbsp;- Chase Sapphire Reserve (CSR)<br>
        &nbsp;&nbsp;&nbsp;- United Quest (UQ)<br>
        &nbsp;&nbsp;&nbsp;- Marriott Bonvoy Brilliant (MB)<br>
        &nbsp;&nbsp;&nbsp;- Delta SkyMiles Amex Gold (DG)<br>
  </p>

  <!-- New purchase input -->
  <div class="card">
    <h2>New Purchase</h2>
    <label>
      Amount ($)
      <input type="number" id="amount" min="0" step="0.01" />
    </label>

    <label>
      Date
      <input type="date" id="date" />
    </label>

    <label>
      Category
      <select id="category">
        <option value="dining">Dining / Restaurants</option>
        <option value="doordash">Doordash</option>
        <option value="lyft">Lyft</option>
        <option value="rideshare_other">Other rideshare (Uber, etc.)</option>
        <option value="united_flight">United flight</option>
        <option value="delta_flight_threshold">Delta flight – threshold chasing</option>
        <option value="delta_flight">Delta flight (not threshold)</option>
        <option value="other_flight">Other airline flight</option>
        <option value="marriott_hotel">Marriott hotel</option>
        <option value="renowned_hotel">Renowned hotel (United program)</option>
        <option value="delta_stays">Delta Stays hotel</option>
        <option value="other_hotel">Other hotel / lodging</option>
        <option value="stubhub">StubHub / viagogo</option>
        <option value="instacart">Instacart</option>
        <option value="streaming">Streaming</option>
        <option value="peloton">Peloton membership</option>
        <option value="other">Other / general</option>
      </select>
    </label>

    <div style="margin-top: 12px;">
      <button class="primary" id="btnRecommend">Get Card Recommendation</button>
      <button id="btnReset" type="button" style="margin-left:8px;">Reset</button>
    </div>

    <div id="recommendationSection" style="margin-top: 12px; display:none;">
      <div id="recommendationBox"></div>
      <div id="reasonBox"></div>

      <div style="margin-top: 10px;">
        <label>
          Card actually used (optional override)
          <select id="cardUsedSelect">
            <option value="">Use recommended card</option>
            <option value="CSR">CSR</option>
            <option value="UQ">United Quest</option>
            <option value="MB">Marriott Brilliant</option>
            <option value="DG">Delta Gold</option>
          </select>
        </label>

        <label>
          Channel actually used (optional override)
          <select id="channelUsedSelect">
            <!-- options populated dynamically based on category -->
          </select>
        </label>

        <div style="margin-top: 8px;">
          <button id="btnSaveTx">Confirm &amp; Save Purchase</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Current month credit usage summary -->
  <div class="card">
    <h2>Current Month – Approx Credits Usage</h2>
    <div id="stateSummary" class="muted"></div>
  </div>

  <!-- Logged transactions -->
  <div class="card">
    <h2>Logged Purchases</h2>

    <!-- New show/hide toggle button -->
    <button id="toggleLogBtn" style="margin-bottom:8px;">
      Show
    </button>

    <!-- Everything below is hidden by default -->
    <div id="logContent" style="display:none;">
      <table id="loggedTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Channel</th>
            <th>Card Used</th>
          </tr>
        </thead>
        <tbody id="txTableBody"></tbody>
      </table>

      <button id="btnClear" style="margin-top:10px;">
        Clear All Logged Purchases
      </button>

      <p class="muted">
        Stored in your browser’s localStorage. Clearing your browser data will wipe this.
      </p>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "cardAdvisorTxsV1";

    // Channel label mapping for human-readable text
    const CHANNEL_LABELS = {
      direct: "direct with the merchant",
      chase_travel: "via Chase Travel portal",
      lyft_app: "in the Lyft app",
      united: "on United.com / app",
      delta: "on Delta.com / app",
      renowned_chase: "via Renowned Hotels (Chase Travel)",
      delta_stays_platform: "on Delta Stays platform",
      stubhub_platform: "on StubHub / viagogo",
      instacart_platform: "on Instacart",
      peloton_platform: "on the Peloton site / app",
    };

    // Allowed channels per category (for override dropdown)
    const CHANNELS_BY_CATEGORY = {
      dining: ["direct"],
      doordash: ["direct"],
      lyft: ["lyft_app"],
      rideshare_other: ["direct"],
      united_flight: ["united"],
      delta_flight_threshold: ["delta"],
      delta_flight: ["delta"],
      other_flight: ["direct", "chase_travel"],
      marriott_hotel: ["direct"],
      renowned_hotel: ["renowned_chase"],
      delta_stays: ["delta_stays_platform"],
      other_hotel: ["direct", "chase_travel"],
      stubhub: ["stubhub_platform"],
      instacart: ["instacart_platform"],
      streaming: ["direct"],
      peloton: ["peloton_platform"],
      other: ["direct"],
    };

    function parseISODate(str) {
      if (!str) return null;
      const d = new Date(str);
      return isNaN(d.getTime()) ? null : d;
    }

    function startOfMonth(d) {
      return new Date(d.getFullYear(), d.getMonth(), 1);
    }

    function loadTransactions() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch {
        return [];
      }
    }

    function saveTransactions(txs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(txs));
    }

    function renderTransactions() {
      const txs = loadTransactions();
      const tbody = document.getElementById("txTableBody");
      tbody.innerHTML = "";

      txs.forEach((tx) => {
        const tr = document.createElement("tr");
        const tdDate = document.createElement("td");
        const tdAmt = document.createElement("td");
        const tdCat = document.createElement("td");
        const tdChan = document.createElement("td");
        const tdCard = document.createElement("td");

        tdDate.textContent = tx.date || "";
        tdAmt.textContent = `$${Number(tx.amount || 0).toFixed(2)}`;
        tdCat.textContent = tx.category || "";
        tdChan.textContent = tx.channel || "";
        tdCard.textContent = tx.cardUsed || "";

        tr.appendChild(tdDate);
        tr.appendChild(tdAmt);
        tr.appendChild(tdCat);
        tr.appendChild(tdChan);
        tr.appendChild(tdCard);

        tbody.appendChild(tr);
      });
    }

    // ---------- computeState (unchanged except for categories you already use) ----------
    function computeState(txs, now) {
      const nowDate = now || new Date();
      const monthStart = startOfMonth(nowDate);

      let mbDiningThisMonth = 0;
      let csrDoordashThisMonth = 0;
      let csrLyftThisMonth = 0;
      let uqRideshareThisMonth = 0;
      let csrStubhubThisMonth = 0;
      let uqInstacartThisMonth = 0;
      let csrPelotonThisMonth = 0;
      let dgDeltaStaysThisMonth = 0;

      for (const tx of txs) {
        if (!tx.date) continue;
        const d = parseISODate(tx.date);
        if (!d) continue;
        if (d < monthStart || d > nowDate) continue;

        const amt = Number(tx.amount) || 0;

        if (tx.cardUsed === "MB" && tx.category === "dining") {
          mbDiningThisMonth += amt;
        }

        if (tx.cardUsed === "CSR" && tx.category === "doordash") {
          csrDoordashThisMonth += amt;
        }

        if (tx.cardUsed === "CSR" && tx.category === "lyft") {
          csrLyftThisMonth += amt;
        }

        if (tx.cardUsed === "UQ" && tx.category === "rideshare_other") {
          uqRideshareThisMonth += amt;
        }

        if (tx.cardUsed === "CSR" && tx.category === "stubhub") {
          csrStubhubThisMonth += amt;
        }

        if (tx.cardUsed === "UQ" && tx.category === "instacart") {
          uqInstacartThisMonth += amt;
        }

        if (tx.cardUsed === "CSR" && tx.category === "peloton") {
          csrPelotonThisMonth += amt;
        }

        if (tx.cardUsed === "DG" && tx.category === "delta_stays") {
          dgDeltaStaysThisMonth += amt;
        }
      }

      return {
        mbDiningThisMonth,
        csrDoordashThisMonth,
        csrLyftThisMonth,
        uqRideshareThisMonth,
        csrStubhubThisMonth,
        uqInstacartThisMonth,
        csrPelotonThisMonth,
        dgDeltaStaysThisMonth,
      };
    }

function renderStateSummary() {
  const txs = loadTransactions();
  const state = computeState(txs);
  const el = document.getElementById("stateSummary");

  const lines = [];

  // MB dining – target ≈ $25/mo
  {
    const met = state.mbDiningThisMonth >= 25;
    const text = `<b>MB dining</b> this month: ~$${state.mbDiningThisMonth.toFixed(
      2
    )} (target ≈ $25/mo of the $300 annual credit)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // CSR Doordash – target ≈ $5/mo
  {
    const met = state.csrDoordashThisMonth >= 5;
    const text = `<b>CSR Doordash</b> this month: ~$${state.csrDoordashThisMonth.toFixed(
      2
    )} (target ≈ $5/mo of the $60 annual credit)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // CSR Lyft – target $10/mo
  {
    const met = state.csrLyftThisMonth >= 10;
    const text = `<b>CSR Lyft</b> this month: ~$${state.csrLyftThisMonth.toFixed(
      2
    )} (target $10/mo Lyft credit)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // UQ rideshare (other) – target ≈ $8/mo
  {
    const met = state.uqRideshareThisMonth >= 8;
    const text = `<b>UQ rideshare (other)</b> this month: ~$${state.uqRideshareThisMonth.toFixed(
      2
    )} (target ≈ $8/mo of the $100 annual credit)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // CSR StubHub/viagogo – target ≈ $25/mo
  {
    const met = state.csrStubhubThisMonth >= 25;
    const text = `<b>CSR StubHub/viagogo</b> this month: ~$${state.csrStubhubThisMonth.toFixed(
      2
    )} (target ≈ $25/mo of the $300 annual credit)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // UQ Instacart – target ≈ $15/mo
  {
    const met = state.uqInstacartThisMonth >= 15;
    const text = `<b>UQ Instacart</b> this month: ~$${state.uqInstacartThisMonth.toFixed(
      2
    )} (target ≈ $15/mo combined Instacart credits)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // CSR Peloton – target ≈ $10/mo
  {
    const met = state.csrPelotonThisMonth >= 10;
    const text = `<b>CSR Peloton</b> membership this month: ~$${state.csrPelotonThisMonth.toFixed(
      2
    )} (target ≈ $10/mo of the $120 annual credit)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // DG Delta Stays – target ≈ $8/mo
  {
    const met = state.dgDeltaStaysThisMonth >= 8;
    const text = `<b>DG Delta Stays</b> this month: ~$${state.dgDeltaStaysThisMonth.toFixed(
      2
    )} (target ≈ $8/mo of the $100 annual credit)`;
    const line = met ? `<span class="credit-met">${text}</span>` : text;
    lines.push(line);
  }

  // Turn into a bullet list
  el.innerHTML =
    "<ul>" + lines.map((line) => `<li>${line}</li>`).join("") + "</ul>";
}

    // ---------- UPDATED recommendCard: decides both card AND channel ----------
    function recommendCard(purchase, state) {
      const { category } = purchase;
      const amount = Number(purchase.amount) || 0;

      // ---- DINING ----
      // 1) MB: $25/mo dining credit.
      // 2) CSR: then becomes default for dining.
      if (category === "dining") {
        if (state.mbDiningThisMonth < 25) {
          return {
            card: "MB",
            channel: "direct",
            reason: `MB: use Brilliant first to burn the ~$25/month dining credit (you’ve logged ~$${state.mbDiningThisMonth.toFixed(
            2
          )} so far this month).`,
          };
        }
        return {
          card: "CSR",
          channel: "direct",
          reason:
            "CSR: MB dining credit is approximated as used; default to CSR for dining for flexible points and your stated preference.",
        };
      }

      // ---- DOORDASH ----
      // 1) CSR: $5/mo Doordash credit.
      // 2) CSR: then default for food delivery.
      if (category === "doordash") {
        if (state.csrDoordashThisMonth < 5) {
          return {
            card: "CSR",
            channel: "direct",
            reason: `CSR: use CSR first to burn the ~$5/month food-delivery slice (you’ve logged ~$${state.csrDoordashThisMonth.toFixed(
            2
          )} so far this month).`,
          };
        }
        return {
          card: "CSR",
          channel: "direct",
          reason:
            "CSR: Doordash credit is approximated as used; still default to CSR for flexible points here.",
        };
      }

      // ---- LYFT ----
      // 1) CSR: $10/mo Lyft credit + boosted Lyft earn.
      if (category === "lyft") {
        if (state.csrLyftThisMonth < 10) {
          return {
            card: "CSR",
            channel: "lyft_app",
            reason: `CSR: Lyft has about $${(
            10 - state.csrLyftThisMonth
          ).toFixed(
            2
          )} of the $10 monthly credit left, plus boosted points on Lyft.`,
          };
        }
        return {
          card: "CSR",
          channel: "lyft_app",
          reason:
            "CSR: Lyft credit is approximated as used, but CSR still wins here thanks to Lyft boosts and flexibility.",
        };
      }

      // ---- OTHER RIDESHARE (Uber etc.) ----
      // 1) UQ: $100/yr rideshare ≈ $8/mo.
      // 2) CSR fallback.
      if (category === "rideshare_other") {
        if (state.uqRideshareThisMonth < 8) {
          return {
            card: "UQ",
            channel: "direct",
            reason: `UQ: use United Quest first to burn the rideshare monthly slice (you’ve logged ~$${state.uqRideshareThisMonth.toFixed(
            2
          )} of an ~$8/month approximation).`,
          };
        }
        return {
          card: "CSR",
          channel: "direct",
          reason:
            "CSR: UQ rideshare credit is approximated as used this month; default to CSR for flexible points.",
        };
      }

      // ---- UNITED FLIGHTS ----
      // You chose: prioritize United loyalty/perks over pure cents-per-point.
      if (category === "united_flight") {
        return {
          card: "UQ",
          channel: "united",
          reason:
            "UQ: For United flights, use United Quest to get miles, free bags/priority boarding, TravelBank benefits, and PQPs.",
        };
      }

      // ---- DELTA FLIGHTS – threshold chasing ----
      if (category === "delta_flight_threshold") {
        return {
          card: "DG",
          channel: "delta",
          reason:
            "DG: You marked this as threshold-chasing; use Delta Gold to work toward the $10k spend for the $200 Delta flight credit.",
        };
      }

      // ---- DELTA FLIGHTS – normal ----
      if (category === "delta_flight") {
        return {
          card: "CSR",
          channel: "delta",
          reason:
            "CSR: Delta flight booked direct; you’re not chasing the Delta threshold here, so default to CSR for travel earn and flexibility.",
        };
      }

      // ---- OTHER FLIGHTS ----
      if (category === "other_flight") {
        return {
          card: "CSR",
          channel: "chase_travel",
          reason:
            "CSR: Other airline – book via Chase Travel with CSR to keep travel earn in flexible points (no special airline perks dominating).",
        };
      }

      // ---- MARRIOTT HOTELS ----
      if (category === "marriott_hotel") {
        return {
          card: "MB",
          channel: "direct",
          reason:
            "MB: Direct Marriott stay – use Brilliant for 6x Bonvoy points plus status alignment and Marriott-specific perks.",
        };
      }

      // ---- RENOWNED HOTELS (United program) ----
      if (category === "renowned_hotel") {
        return {
          card: "UQ",
          channel: "renowned_chase",
          reason:
            "UQ: Renowned Hotels booking – use United Quest to trigger the Renowned credit and boosted United earn.",
        };
      }

      // ---- DELTA STAYS ----
      if (category === "delta_stays") {
        if (state.dgDeltaStaysThisMonth < 8) {
          return {
            card: "DG",
            channel: "delta_stays_platform",
            reason:
              "DG: Use Delta Gold first at Delta Stays to work through the ~$8/month slice of the $100 annual Delta Stays credit.",
          };
        }
        return {
          card: "CSR",
          channel: "delta_stays_platform",
          reason:
            "CSR: Delta Stays credit is approximated as used; defaulting to CSR for flexible travel points.",
        };
      }

      // ---- OTHER HOTELS / LODGING ----
      if (category === "other_hotel") {
        return {
          card: "CSR",
          channel: "chase_travel",
          reason:
            "CSR: Non-Marriott hotel – book via Chase Travel with CSR to centralize travel earn in flexible points.",
        };
      }

      // ---- STUBHUB / VIAGOGO ----
      if (category === "stubhub") {
        if (state.csrStubhubThisMonth < 25) {
          return {
            card: "CSR",
            channel: "stubhub_platform",
            reason: `CSR: Use CSR first on StubHub/viagogo to work through the ~$25/month share of your $300 annual StubHub credit (you’ve logged ~$${state.csrStubhubThisMonth.toFixed(
            2
          )}).`,
          };
        }
        return {
          card: "CSR",
          channel: "stubhub_platform",
          reason:
            "CSR: StubHub credit approximated as used this month; CSR still wins as default for flexibility.",
        };
      }

      // ---- INSTACART ----
      if (category === "instacart") {
        if (state.uqInstacartThisMonth < 15) {
          return {
            card: "UQ",
            channel: "instacart_platform",
            reason: `UQ: Use United Quest for Instacart to burn through the combined ~$15/month Instacart credits (you’ve logged ~$${state.uqInstacartThisMonth.toFixed(
            2
          )}).`,
          };
        }
        return {
          card: "CSR",
          channel: "instacart_platform",
          reason:
            "CSR: Instacart credits approximated as used; defaulting to CSR for flexible points.",
        };
      }

      // ---- STREAMING ----
      if (category === "streaming") {
        return {
          card: "UQ",
          channel: "direct",
          reason:
            "UQ: Streaming earns bonus miles on United Quest; after that, CSR stays your general default elsewhere.",
        };
      }

      // ---- PELOTON MEMBERSHIP ----
      if (category === "peloton") {
        if (state.csrPelotonThisMonth < 10) {
          return {
            card: "CSR",
            channel: "peloton_platform",
            reason: `CSR: Use CSR for Peloton membership to consume the ~$10/month Peloton credit (you’ve logged ~$${state.csrPelotonThisMonth.toFixed(
            2
          )}).`,
          };
        }
        return {
          card: "CSR",
          channel: "peloton_platform",
          reason:
            "CSR: Peloton membership credit approximated as used; CSR remains your default here for simplicity.",
        };
      }

      // ---- GENERAL / FALLBACK ----
      return {
        card: "CSR",
        channel: "direct",
        reason:
          "CSR: No special time-bound credit or category perk dominates here, so defaulting to CSR as you requested.",
      };
    }

    // ---------- UI wiring ----------

    let lastRecommendation = null;

    function initFormDefaults() {
      const dateInput = document.getElementById("date");
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      dateInput.value = `${yyyy}-${mm}-${dd}`;
    }

    document.getElementById("btnRecommend").addEventListener("click", () => {
      const amount = document.getElementById("amount").value;
      const date = document.getElementById("date").value;
      const category = document.getElementById("category").value;

      if (!amount || !date) {
        alert("Please enter amount and date.");
        return;
      }

      const purchase = {
        amount,
        date,
        category,
      };

      const txs = loadTransactions();
      const state = computeState(txs);
      const rec = recommendCard(purchase, state);
      lastRecommendation = { purchase, rec };

      const channelLabel = CHANNEL_LABELS[rec.channel] || rec.channel;
      document.getElementById("recommendationBox").textContent =
        `Recommended: ${rec.card} – ${channelLabel}`;
      document.getElementById("reasonBox").textContent = rec.reason;
      document.getElementById("recommendationSection").style.display = "block";

      // Pre-select recommended in override dropdowns
      const cardSel = document.getElementById("cardUsedSelect");
      cardSel.value = "";

      const chanSelect = document.getElementById("channelUsedSelect");
      chanSelect.innerHTML = "";

      const relevantChannels = CHANNELS_BY_CATEGORY[category] || ["direct"];
      relevantChannels.forEach((code) => {
        const opt = document.createElement("option");
        opt.value = code;
        opt.textContent = CHANNEL_LABELS[code] || code;
        chanSelect.appendChild(opt);
      });

      // If recommended channel is in list, select it; otherwise leave first option
      if (relevantChannels.includes(rec.channel)) {
        chanSelect.value = rec.channel;
      }
    });

    document.getElementById("btnSaveTx").addEventListener("click", () => {
      if (!lastRecommendation) {
        alert("Get a recommendation first.");
        return;
      }
      const overrideCard = document.getElementById("cardUsedSelect").value;
      const overrideChannel = document.getElementById("channelUsedSelect").value;

      const cardUsed = overrideCard || lastRecommendation.rec.card;
      const channelUsed = overrideChannel || lastRecommendation.rec.channel;

      const tx = {
        date: lastRecommendation.purchase.date,
        amount: lastRecommendation.purchase.amount,
        category: lastRecommendation.purchase.category,
        channel: channelUsed,
        cardUsed,
      };

      const txs = loadTransactions();
      txs.push(tx);
      saveTransactions(txs);
      renderTransactions();
      renderStateSummary();

      alert("Purchase saved.");
    });

        document.getElementById("btnReset").addEventListener("click", () => {
      // Clear amount
      document.getElementById("amount").value = "";

      // Reset date to today
      initFormDefaults();

      // Reset category to default (first option: dining)
      document.getElementById("category").value = "dining";

      // Hide recommendation section and clear its content
      document.getElementById("recommendationSection").style.display = "none";
      document.getElementById("recommendationBox").textContent = "";
      document.getElementById("reasonBox").textContent = "";

      // Reset override dropdowns
      document.getElementById("cardUsedSelect").value = "";
      const chanSelect = document.getElementById("channelUsedSelect");
      chanSelect.innerHTML = "";

      // Clear last recommendation state
      lastRecommendation = null;
    });


    document.getElementById("btnClear").addEventListener("click", () => {
      if (!confirm("Clear all logged purchases?")) return;
      saveTransactions([]);
      renderTransactions();
      renderStateSummary();
    });

        // Show/Hide Logged Purchases section
    const logContent = document.getElementById("logContent");
    const toggleLogBtn = document.getElementById("toggleLogBtn");

    toggleLogBtn.addEventListener("click", () => {
      const isHidden =
        logContent.style.display === "none" || logContent.style.display === "";

      if (isHidden) {
        logContent.style.display = "block";
        toggleLogBtn.textContent = "Hide";
      } else {
        logContent.style.display = "none";
        toggleLogBtn.textContent = "Show";
      }
    });

    // Init on load
    initFormDefaults();
    renderTransactions();
    renderStateSummary();
  </script>
</body>
</html>
